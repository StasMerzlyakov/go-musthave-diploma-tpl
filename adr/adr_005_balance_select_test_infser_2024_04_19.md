# ADR_005

## Название
Проверка наличия и, при необходимости, создание записи о балансе при получении баланса

## Статус
proposed

## Дата
2024-04-19

## Контекст
При получании баланса записей для пользователя таких записей может и не быть. Хочется сделать так, что после вызова функции получения баланса запись точно была создана. Можно добавить создание записи с нулевым балансом в функцию регистрации пользователя, но, в случае развития проекта(например будут ещё какие-то подсистемы) придется каждый раз добавлять инициализацию данных для этих подсистем в метод регистарции пользователя - что будет сложно поддерживать и покрывать тестами.

## Описание принятого/предложенного решения
Основываясь на статье [Write a Postgres Get or Create SQL Query](https://stackoverflow.com/questions/16123944/write-a-postgres-get-or-create-sql-query) sql для получения баланса выглядит так:


```sql
-- запрос на получение пользователя
 with ins as (
 insert into balance(userId) values (1) on conflict (userId) do nothing returning *
 )
 select * from ins
 union
 select * from balance
 where userId=1;
```

## Недостатки решения


## Комментарии

